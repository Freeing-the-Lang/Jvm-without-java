name: "ğŸ›ï¸ JVM Without Java â€” Meaning-Based Interpreter & C++ Transpiler"

on:
  push:
    branches: [ main ]
  pull_request:
    types: [ closed ]
  workflow_dispatch:
  schedule:
    - cron: "0 9 * * *"  # ë§¤ì¼ ì˜¤ì „ 9ì‹œ ProofLedger ìë™ ì¬ê²€ì¦

permissions:
  contents: write

# ğŸ”’ ì·¨ì†Œ ë°©ì§€ ë° ì•ˆì • ì‹¤í–‰
concurrency:
  group: jvm-without-java-${{ github.ref }}
  cancel-in-progress: false

jobs:
  build-ubuntu:
    name: "ğŸ§± Build & Run on Ubuntu"
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: "ğŸ§­ Checkout Repository"
        uses: actions/checkout@v4

      - name: "âš™ï¸ Verify Compiler"
        shell: bash
        run: |
          echo "Using system compiler:"
          g++ --version

      - name: "ğŸ—ï¸ Build Meaning-Based Runtime & Transpiler"
        shell: bash
        run: |
          mkdir -p build
          echo "ğŸ”§ Building meaning-based runtime..."
          g++ -std=c++17 src/semantic_jvmfree_run.cpp -o build/jvmrun
          echo "ğŸ”§ Building semantic transpiler..."
          g++ -std=c++17 src/semantic_jvmfreec.cpp -o build/jvmc

      - name: "ğŸ§ª Run Example (Hello.java)"
        shell: bash
        run: |
          echo 'class Hello { int x = 10; void main() { System.out.println("Running meaning-level Java in C++!"); int y = 3; System.out.println("Sum: " + y); } }' > Hello.java
          echo "ğŸš€ Running interpreter..."
          ./build/jvmrun Hello.java
          echo "ğŸ“„ ProofLedger.txt content:"
          cat proofledger.txt

      - name: "ğŸ§¾ Upload ProofLedger Artifact"
        uses: actions/upload-artifact@v4
        with:
          name: proofledger
          path: proofledger.txt

      - name: "ğŸ“¦ Generate C++ Transpiled Output"
        shell: bash
        run: |
          echo "âš™ï¸ Generating transpiled output..."
          ./build/jvmc Hello.java
          echo "------ out.cpp ------"
          cat out.cpp
